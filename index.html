<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Calculadora de NPK</title>
    <style>
        body {
    font-family: Arial, sans-serif;
    margin: 20px;
}

h1, h2 {
    color: #2E8B57;
}

input, button, select {
    margin: 5px;
}

#lista-materias-primas, #lista-cultivos {
    margin-top: 10px;
}

#resultado-npk, #resultado-kg-por-hectarea {
    margin-top: 20px;
    font-weight: bold;
}

    </style>
</head>
<body>
    <h1>Calculadora de NPK</h1>

    <!-- Sección de Materias Primas -->
    <h2>Materias Primas</h2>
    <div id="materias-primas">
        <!-- Formulario para añadir materias primas -->
        <input type="text" id="mp-nombre" placeholder="Nombre del producto">
        <input type="number" id="mp-nitrogeno" placeholder="Nitrógeno (%)">
        <input type="number" id="mp-fosforo" placeholder="Fósforo (%)">
        <input type="number" id="mp-potasio" placeholder="Potasio (%)">
        <input type="number" id="mp-materia-organica" placeholder="Materia Orgánica (%)">
        <input type="number" id="mp-precio" placeholder="Precio ($)">
        <button onclick="añadirMateriaPrima()">Añadir Materia Prima</button>
        <button onclick="guardarMateriasPrimas()">Guardar Materias Primas</button>
        <button onclick="cargarMateriasPrimas()">Cargar Materias Primas</button>
        <div id="lista-materias-primas"></div>
    </div>

    <!-- Sección para introducir el NPK deseado -->
    <h2>NPK Deseado</h2>
    <input type="number" id="npk-nitrogeno" placeholder="Nitrógeno deseado (%)">
    <input type="number" id="npk-fosforo" placeholder="Fósforo deseado (%)">
    <input type="number" id="npk-potasio" placeholder="Potasio deseado (%)">
    <button onclick="calcularNPK()">Calcular NPK</button>

    <div id="resultado-npk"></div>

    <!-- Sección de Cultivos -->
    <h2>Cultivos</h2>
    <div id="cultivos">
        <!-- Formulario para añadir cultivos -->
        <input type="text" id="cultivo-nombre" placeholder="Nombre del cultivo">
        <input type="number" id="cultivo-nitrogeno" placeholder="Nitrógeno necesario (kg/ha)">
        <input type="number" id="cultivo-fosforo" placeholder="Fósforo necesario (kg/ha)">
        <input type="number" id="cultivo-potasio" placeholder="Potasio necesario (kg/ha)">
        <button onclick="añadirCultivo()">Añadir Cultivo</button>
        <button onclick="guardarCultivos()">Guardar Cultivos</button>
        <button onclick="cargarCultivos()">Cargar Cultivos</button>
        <div id="lista-cultivos"></div>
    </div>

    <!-- Sección para calcular kg/ha -->
    <h2>Cálculo de kg/ha</h2>
    <select id="seleccionar-cultivo">
        <option value="">Selecciona un cultivo</option>
    </select>
    <button onclick="calcularKgPorHectarea()">Calcular kg/ha</button>
    <div id="resultado-kg-por-hectarea"></div>

    <script>
        // Variables globales
let materiasPrimas = [];
let cultivos = [];

// Funciones para materias primas
function añadirMateriaPrima() {
    let nombre = document.getElementById('mp-nombre').value;
    let nitrogeno = parseFloat(document.getElementById('mp-nitrogeno').value);
    let fosforo = parseFloat(document.getElementById('mp-fosforo').value);
    let potasio = parseFloat(document.getElementById('mp-potasio').value);
    let materiaOrganica = parseFloat(document.getElementById('mp-materia-organica').value);
    let precio = parseFloat(document.getElementById('mp-precio').value);

    let materiaPrima = {
        nombre,
        nitrogeno,
        fosforo,
        potasio,
        materiaOrganica,
        precio
    };

    materiasPrimas.push(materiaPrima);
    mostrarMateriasPrimas();
}

function mostrarMateriasPrimas() {
    let lista = document.getElementById('lista-materias-primas');
    lista.innerHTML = '';
    materiasPrimas.forEach((mp, index) => {
        lista.innerHTML += `<div>
            ${mp.nombre} - N:${mp.nitrogeno}% P:${mp.fosforo}% K:${mp.potasio}% MO:${mp.materiaOrganica}% Precio:${mp.precio}$
            <button onclick="eliminarMateriaPrima(${index})">Eliminar</button>
        </div>`;
    });
}

function eliminarMateriaPrima(index) {
    materiasPrimas.splice(index, 1);
    mostrarMateriasPrimas();
}

function guardarMateriasPrimas() {
    localStorage.setItem('materiasPrimas', JSON.stringify(materiasPrimas));
    alert('Materias primas guardadas.');
}

function cargarMateriasPrimas() {
    let data = localStorage.getItem('materiasPrimas');
    if (data) {
        materiasPrimas = JSON.parse(data);
        mostrarMateriasPrimas();
    } else {
        alert('No hay materias primas guardadas.');
    }
}

// Funciones para cultivos
function añadirCultivo() {
    let nombre = document.getElementById('cultivo-nombre').value;
    let nitrogeno = parseFloat(document.getElementById('cultivo-nitrogeno').value);
    let fosforo = parseFloat(document.getElementById('cultivo-fosforo').value);
    let potasio = parseFloat(document.getElementById('cultivo-potasio').value);

    let cultivo = {
        nombre,
        nitrogeno,
        fosforo,
        potasio
    };

    cultivos.push(cultivo);
    mostrarCultivos();
    actualizarSeleccionCultivos();
}

function mostrarCultivos() {
    let lista = document.getElementById('lista-cultivos');
    lista.innerHTML = '';
    cultivos.forEach((c, index) => {
        lista.innerHTML += `<div>
            ${c.nombre} - N:${c.nitrogeno}kg/ha P:${c.fosforo}kg/ha K:${c.potasio}kg/ha
            <button onclick="eliminarCultivo(${index})">Eliminar</button>
        </div>`;
    });
}

function eliminarCultivo(index) {
    cultivos.splice(index, 1);
    mostrarCultivos();
    actualizarSeleccionCultivos();
}

function guardarCultivos() {
    localStorage.setItem('cultivos', JSON.stringify(cultivos));
    alert('Cultivos guardados.');
}

function cargarCultivos() {
    let data = localStorage.getItem('cultivos');
    if (data) {
        cultivos = JSON.parse(data);
        mostrarCultivos();
        actualizarSeleccionCultivos();
    } else {
        alert('No hay cultivos guardados.');
    }
}

function actualizarSeleccionCultivos() {
    let select = document.getElementById('seleccionar-cultivo');
    select.innerHTML = '<option value="">Selecciona un cultivo</option>';
    cultivos.forEach((c, index) => {
        select.innerHTML += `<option value="${index}">${c.nombre}</option>`;
    });
}

// Función para calcular NPK
function calcularNPK() {
    let nDeseado = parseFloat(document.getElementById('npk-nitrogeno').value);
    let pDeseado = parseFloat(document.getElementById('npk-fosforo').value);
    let kDeseado = parseFloat(document.getElementById('npk-potasio').value);

    // Aquí iría el algoritmo para calcular las proporciones de materias primas
    // Para simplificar, usaremos una aproximación

    // Validar si hay suficientes materias primas para cubrir los nutrientes deseados
    if (materiasPrimas.length === 0) {
        alert('No hay materias primas disponibles.');
        return;
    }

    // Este es un problema de optimización lineal y es complejo de resolver sin programación avanzada
    // Para este ejemplo, asumiremos que las materias primas se mezclan en proporciones iguales

    let totalN = 0;
    let totalP = 0;
    let totalK = 0;
    let totalMO = 0;
    let totalPrecio = 0;

    let porcentajePorMateria = 100 / materiasPrimas.length;

    materiasPrimas.forEach(mp => {
        totalN += (mp.nitrogeno * porcentajePorMateria) / 100;
        totalP += (mp.fosforo * porcentajePorMateria) / 100;
        totalK += (mp.potasio * porcentajePorMateria) / 100;
        totalMO += (mp.materiaOrganica * porcentajePorMateria) / 100;
        totalPrecio += (mp.precio * porcentajePorMateria) / 100;
    });

    let resultado = document.getElementById('resultado-npk');
    resultado.innerHTML = `
        Nitrógeno resultante: ${totalN.toFixed(2)}%<br>
        Fósforo resultante: ${totalP.toFixed(2)}%<br>
        Potasio resultante: ${totalK.toFixed(2)}%<br>
        Materia Orgánica resultante: ${totalMO.toFixed(2)}%<br>
        Precio estimado: ${totalPrecio.toFixed(2)}$
    `;
}

// Función para calcular kg/ha
function calcularKgPorHectarea() {
    let indiceCultivo = document.getElementById('seleccionar-cultivo').value;
    if (indiceCultivo === '') {
        alert('Selecciona un cultivo.');
        return;
    }

    let cultivo = cultivos[indiceCultivo];

    // Asumimos que ya se ha calculado el NPK resultante
    // Para simplificar, tomaremos un NPK genérico
    let nFertilizante = 20;
    let pFertilizante = 20;
    let kFertilizante = 20;

    let kgPorHectareaN = cultivo.nitrogeno / (nFertilizante / 100);
    let kgPorHectareaP = cultivo.fosforo / (pFertilizante / 100);
    let kgPorHectareaK = cultivo.potasio / (kFertilizante / 100);

    let kgPorHectarea = Math.max(kgPorHectareaN, kgPorHectareaP, kgPorHectareaK);

    let resultado = document.getElementById('resultado-kg-por-hectarea');
    resultado.innerHTML = `Cantidad adecuada a utilizar: ${kgPorHectarea.toFixed(2)} kg/ha`;
}

    </script>
</body>
</html>
